<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, viewport-fit=cover"
  />
  <title>Happy Birthday name üéâ</title>

  <!-- Fonts & perf -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      --bg1: #dff5ee;
      --bg2: #a7ded0;
      --brand: #2fbf9b;
      --safe-gap: 20px;
      --vh: 1vh;
    }

    html, body {
      margin: 0;
      height: 100%;
      overflow: hidden;
      background: linear-gradient(to bottom right, var(--bg1), var(--bg2));
    }

    @supports (height: 100dvh) {
      #globeViz { height: 100dvh; }
      canvas.confetti-canvas { height: 100dvh !important; }
    }

    /* Loader */
    #loadingScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(to bottom right, var(--bg1), var(--bg2));
      display: grid;
      place-content: center;
      gap: 16px;
      z-index: 10;
      color: #fff;
      font-family: 'Pacifico', cursive;
      text-align: center;
      padding: 24px;
    }

    .ml11 { font-weight: 500; font-size: clamp(2rem, 4vw, 3rem); white-space: nowrap; }
    .loading-bar-container { width: min(350px, 85vw); height: 28px; background: #fff; border-radius: 10px; overflow: hidden; margin: 6px auto 0; }
    .loading-bar { height: 100%; width: 0%; background: var(--brand); transition: width 0.2s linear; }
    .loading-percentage { font-size: clamp(20px, 3vw, 26px); }
    .continue-text { opacity: 0; margin-top: 6px; font-size: clamp(18px, 3vw, 26px); transition: opacity 0.5s; }

    /* Titles */
    .title {
      position: absolute;
      top: 20px; width: 100%; text-align: center;
      font-family: 'Pacifico', cursive; font-size: clamp(2.2rem, 5vw, 4rem);
      color: #fff; text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
      z-index: 5; padding: 0 12px; box-sizing: border-box;
    }
    .subtitle {
      position: absolute;
      bottom: max(20px, env(safe-area-inset-bottom)); width: 100%; text-align: center;
      font-family: 'Pacifico', cursive; font-size: clamp(1.1rem, 3vw, 2.2rem);
      color: #fff; text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.4);
      z-index: 5; padding: 0 12px; box-sizing: border-box;
    }

    #globeViz { width: 100vw; height: calc(var(--vh) * 100); position: relative; z-index: 1; }

    .card {
      position: absolute; left: 50%; transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95); padding: 16px 22px; border-radius: 12px;
      text-align: center; width: 820px; z-index: 5; display: none; visibility: hidden;
      font-family: 'Pacifico', cursive; font-size: clamp(18px, 1.15vw, 24px);
      box-shadow: 0 8px 24px rgba(0,0,0,.15);
    }

    .nav-buttons {
      position: absolute; bottom: 80px; width: 100%; text-align: center; z-index: 6;
      display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; padding: 0 10px;
    }
    .nav-buttons button {
      padding: clamp(10px, 3vw, 20px) clamp(16px, 4vw, 40px);
      font-size: clamp(22px, 4vw, 36px);
      cursor: pointer; border: none; background: var(--brand); color: white; border-radius: 12px;
      font-family: 'Pacifico', cursive; transition: transform 0.06s ease, opacity 0.3s;
    }
    .nav-buttons button:active { transform: translateY(1px) scale(.99); }
    .nav-buttons button:disabled { opacity: .5; cursor: not-allowed; }
    .pulsing { animation: pulse 2s infinite; }
    @keyframes pulse { 0%{box-shadow:0 0 0 0 rgba(47,191,155,.7)} 70%{box-shadow:0 0 0 15px rgba(47,191,155,0)} 100%{box-shadow:0 0 0 0 rgba(47,191,155,0)} }
    .pulsating-vibrating { animation: pulseFade 1.5s infinite ease-in-out, vibrate 1s infinite linear; }
    @keyframes pulseFade { 0%,100%{opacity:.5;transform:scale(1)} 50%{opacity:1;transform:scale(1.05)} }
    @keyframes vibrate { 0%{transform:translateX(0)}20%{transform:translateX(-1px)}40%{transform:translateX(1px)}60%{transform:translateX(-1px)}80%{transform:translateX(2px)}100%{transform:translateX(0)} }

    /* Slideshow */
    .slideshow { position: relative; width: 100%; height: 260px; overflow: hidden; border-radius: 10px; background: #fff; }
    .slideshow .slide { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: contain; opacity: 0; transition: opacity .5s ease; }
    .slideshow .slide.active { opacity: 1; }
    .arrow-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(47, 191, 155, 0.9); color: #fff; border: none; border-radius: 999px; width: 36px; height: 36px; font-size: 20px; cursor: pointer; }
    .arrow-left { left: 8px; } .arrow-right { right: 8px; }
    .slide-controls { display: flex; justify-content: center; gap: 6px; margin-top: 6px; }
    .dot { width: 9px; height: 9px; border-radius: 50%; background: #d7f3ea; cursor: pointer; }
    .dot.active { background: var(--brand); }

    @media (max-width: 600px) {
      .card { width: min(95vw, 420px); padding: 10px 12px; font-size: clamp(14px, 4vw, 18px); height: var(--card-target-height, 340px); max-height: var(--card-target-height, 340px); overflow-y: hidden; }
      .slideshow { height: 180px; }
    }
  </style>
</head>
<body>
  <div id="loadingScreen">
    <div class="ml11">Preparing your surprise2<span id="dots">...</span></div>
    <div class="loading-bar-container"><div class="loading-bar" id="loadingBar"></div></div>
    <div class="loading-percentage" id="loadingPercentage">0%</div>
    <div class="continue-text" id="continueText">[Press ENTER or Tap to continue]</div>
  </div>

  <div class="title" id="titleText">üéÇ Happy Birthday name üéÇ</div>
  <div id="globeViz"></div>
  <div class="subtitle" id="subtitleText">From country1 to country2, to country3... and beyond ‚ù§Ô∏è</div>
  <div id="airplane">‚úàÔ∏è</div>
  <div id="infoCard" class="card"></div>
  <div class="nav-buttons">
    <button id="prevBtn" style="display:none;">‚¨Ö Previous</button>
    <button id="nextBtn" style="display:none;">Next ‚û°</button>
    <button id="endBtn" style="display:none;">End üéâ</button>
    <button id="startBtn" class="pulsing">Start ‚úàÔ∏è</button>
  </div>

  <script src="https://unpkg.com/globe.gl"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    // Variables
    const PERSON_NAME = 'name';
    const FROM_TO = ['country1', 'country2', 'country3'];
    document.title = `Happy Birthday ${PERSON_NAME} üéâ`;
    document.getElementById('titleText').textContent = `üéÇ Happy Birthday ${PERSON_NAME} üéÇ`;
    document.getElementById('subtitleText').textContent = `From ${FROM_TO.join(' to ')}, and beyond ‚ù§Ô∏è`;

    const places = [
      { lat: 25.0, lng: 19.0, name: "Turkey", message: "We first crossed paths here ‚Äî two lives meeting in the middle of a busy world. I didn‚Äôt know it then, but that moment was the start of something extraordinary.", imgs: ["image1.jpg","image1b.jpg"] },
      { lat: 26.5, lng: 42.2, name: "Azerbaijan", message: "You returned home, and I went my way‚Ä¶ but the distance never truly kept us apart. Every day we spoke, every day we laughed, and with every word our connection grew stronger.", imgs: ["image2.jpg","image2b.jpg","image2c.jpg","image2d.jpg"] },
      { lat: 22.5, lng: 14.5, name: "Greece", message: "Then you came to visit, and we turned days into memories. From sunlit streets to quiet moments by the sea, Greece became our playground of joy.", imgs: ["image3.jpg","image3b.jpg","image3c.jpg","image3d.jpg","image3e.jpg","image3f.jpg","image3g.jpg","image3h.jpg","image3i.jpg"] },
      { lat: 49.5, lng: 5.0, name: "Sweden", message: "Now, our eyes are set on a new horizon ‚Äî a place to start fresh, to dream bigger, and to build a life together one step at a time.", imgs: ["image4.jpg","image4b.jpg"] },
      { lat: 51.0, lng: -29.5, name: "Iceland", message: "And one day soon, we‚Äôll stand here, surrounded by the colors of the northern sky, living out a dream we‚Äôve carried in our hearts all along", imgs: ["image5.jpg","image5b.jpg"] }
    ];

    const loadingScreen = document.getElementById('loadingScreen');
    const bar = document.getElementById('loadingBar');
    const perc = document.getElementById('loadingPercentage');
    const contText = document.getElementById('continueText');

    // Animated dots
    setInterval(() => {
      const dots = document.getElementById('dots');
      dots.textContent = dots.textContent.length >= 3 ? '' : dots.textContent + '.';
    }, 500);

    // Preload
    function preloadAssets(urls, onProgress) {
      let done = 0;
      const total = urls.length || 1;
      return Promise.all(urls.map(u => new Promise(res => {
        const i = new Image();
        i.onload = i.onerror = () => { done++; onProgress(Math.round((done/total)*100)); res(); };
        i.src = u;
      })));
    }

    const assets = ['earth-cartoon.png', ...places.flatMap(p => p.imgs)];
    preloadAssets(assets, v => { bar.style.width = v+'%'; perc.textContent = v+'%'; })
      .then(() => { contText.style.opacity = 1; contText.classList.add('pulsating-vibrating'); });

    document.addEventListener('keydown', e => { if (e.key === 'Enter') loadingScreen.style.display = 'none'; });
    document.addEventListener('click', () => { loadingScreen.style.display = 'none'; });

    // Confetti
    setInterval(() => { confetti({ particleCount: 80, spread: 120, origin: { y: Math.random(), x: Math.random() } }); }, 1500);

    const world = Globe()(document.getElementById('globeViz'))
      .globeImageUrl('earth-cartoon.png')
      .backgroundColor('rgba(0,0,0,0)')
      .pointOfView({ lat: 20, lng: 0, altitude: 2 }, 0)
      .labelsData(places)
      .labelLat(d => d.lat)
      .labelLng(d => d.lng)
      .labelText(d => d.name)
      .labelSize(1)
      .labelDotRadius(0.65)
      .labelColor(() => 'white')
      .atmosphereColor('#9fe3d2')
      .atmosphereAltitude(0.18);

    // Disable autorotation
    world.controls().autoRotate = false;

    const card = document.getElementById('infoCard');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const endBtn = document.getElementById('endBtn');
    const startBtn = document.getElementById('startBtn');
    const airplane = document.getElementById('airplane');
    let currentIndex = -1;

    function getLatDownOffset() { return 8; }
    function positionCardAbovePin(place, gap = 10) {
      const coords = world.getScreenCoords(place.lat, place.lng);
      if (!coords) return;
      const h = card.offsetHeight || 0;
      card.style.left = coords.x + 'px';
      card.style.top = (coords.y - h - gap) + 'px';
      card.style.transform = 'translateX(-50%)';
    }
    function revealCard() { card.style.visibility = 'visible'; }

    function flyPlaneTo(lat, lng, cb) {
      const latOffset = getLatDownOffset();
      world.pointOfView({ lat: parseFloat(lat) + latOffset, lng: parseFloat(lng), altitude: 0.8 }, 1200);
      airplane.style.display = 'block';
      const c = world.getScreenCoords(lat, lng);
      if (c) { airplane.style.left = c.x+'px'; airplane.style.top = c.y+'px'; }
      setTimeout(() => { airplane.style.display = 'none'; cb && cb(); }, 1200);
    }

    function updateCard(index) {
      const place = places[index];
      card.innerHTML = `<div class="slideshow">${place.imgs.map((src,i)=>`<img class="slide ${i===0?'active':''}" src="${src}" alt="">`).join('')}</div><p>${place.message}</p>`;
      positionCardAbovePin(place);
      revealCard();
      prevBtn.style.display = index > 0 ? 'inline-block' : 'none';
      nextBtn.style.display = index < places.length - 1 ? 'inline-block' : 'none';
      endBtn.style.display = index === places.length - 1 ? 'inline-block' : 'none';
    }

    startBtn.onclick = () => {
      currentIndex = 0;
      flyPlaneTo(places[0].lat, places[0].lng, () => { updateCard(0); startBtn.style.display = 'none'; });
    };
    nextBtn.onclick = () => { currentIndex++; flyPlaneTo(places[currentIndex].lat, places[currentIndex].lng, () => updateCard(currentIndex)); };
    prevBtn.onclick = () => { currentIndex--; flyPlaneTo(places[currentIndex].lat, places[currentIndex].lng, () => updateCard(currentIndex)); };
    endBtn.onclick = () => { card.innerHTML = `<h2>üéâ Happy Birthday! üéâ</h2><p>And through it all...</p>`; revealCard(); prevBtn.style.display=nextBtn.style.display=endBtn.style.display='none'; };
  </script>
</body>
</html>
