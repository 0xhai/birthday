<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Happy Birthday name üéâ</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
  <style>
    html, body { 
      margin: 0; 
      height: 100%; 
      overflow: hidden; 
      background: linear-gradient(to bottom right, #ffcccc, #ff99cc); 
    }

    #loadingScreen {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: linear-gradient(to bottom right, #ffcccc, #ff99cc);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 10;
      color: #fff;
      font-family: 'Pacifico', cursive;
    }

    .ml11 {
      font-weight: 500;
      font-size: clamp(2.2rem, 4vw, 3rem);
      white-space: nowrap;
      overflow: hidden;
    }

    .loading-bar-container {
      width: 350px;
      height: 28px;
      background: #fff;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 20px;
      position: relative;
    }

    .loading-bar {
      height: 100%;
      width: 0%;
      background: #ff69b4;
      transition: width 0.2s;
    }

    .loading-percentage {
      margin-top: 5px;
      font-size: 26px;
      font-family: 'Pacifico', cursive;
    }

    .continue-text {
      opacity: 0;
      margin-top: 15px;
      font-size: 26px;
      font-family: 'Pacifico', cursive;
      transition: opacity 0.5s;
    }

    #globeViz { 
      width: 100vw; 
      height: 100vh; 
      position: relative;
      z-index: 1;
    }

    .popup {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 15px 20px;
      border-radius: 10px;
      font-family: 'Pacifico', cursive;
      font-size: 18px;
      display: none;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.2);
    }

    .title {
      position: absolute;
      top: 20px;
      width: 100%;
      text-align: center;
      font-family: 'Pacifico', cursive;
      font-size: clamp(2.8rem, 5vw, 4rem);
      color: #fff;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.4);
      z-index: 5;
    }

    .subtitle {
      position: absolute;
      bottom: 20px;
      width: 100%;
      text-align: center;
      font-family: 'Pacifico', cursive;
      font-size: clamp(1.5rem, 3vw, 2.5rem);
      color: #fff;
      text-shadow: 2px 2px 5px rgba(0,0,0,0.4);
      z-index: 5;
    }

    .card {
      position: fixed; /* fixed so it doesn‚Äôt scroll with globe canvas */
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(6px);
      padding: 24px;
      border-radius: 14px;
      text-align: left;
      width: min(36ch, 92vw);
      max-height: min(60vh, 460px);
      overflow: auto;
      z-index: 5;
      display: none;
      font-family: 'Pacifico', cursive;
      font-size: clamp(18px, 2.6vw, 22px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.18);
    }

    /* corner helpers */
    .card--tl { top: 20px; left: 20px; right: auto; bottom: auto; }
    .card--tr { top: 20px; right: 20px; left: auto; bottom: auto; }
    .card--bl { bottom: 20px; left: 20px; right: auto; top: auto; }
    .card--br { bottom: 20px; right: 20px; left: auto; top: auto; }

    .card img { 
      width: 100%; 
      height: auto; 
      border-radius: 10px; 
      display: block; 
      margin-bottom: 12px; 
    }

    /* tiny screens: keep it compact */
    @media (max-width: 600px) {
      .card { 
        width: 88vw; 
        max-height: 55vh; 
        padding: 16px; 
        font-size: clamp(16px, 4vw, 18px);
      }
    }
    
    .nav-buttons {
      position: absolute;
      bottom: 80px;
      width: 100%;
      text-align: center;
      z-index: 6;
    }

    .nav-buttons button {
      padding: clamp(10px, 3vw, 20px) clamp(16px, 4vw, 40px);
      font-size: clamp(28px, 4vw, 50px);
      cursor: pointer;
      border: none;
      background: #ff69b4;
      color: white;
      border-radius: 8px;
      margin: 0 10px;
      font-family: 'Pacifico', cursive;
      transition: opacity 0.3s;
    }

    .nav-buttons button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #airplane {
      position: absolute;
      font-size: 100px;
      z-index: 9999;
      transition: transform 1s linear;
      display: block;
    }

    canvas.confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 0 !important;
      pointer-events: none;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 105, 180, 0.7);
      }
      70% {
        box-shadow: 0 0 0 15px rgba(255, 105, 180, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(255, 105, 180, 0);
      }
    }

    .pulsing {
      animation: pulse 2s infinite;
    }

    @media screen and (max-width: 600px) {
      .ml11 {
        font-size: 1.4rem;
      }
      .loading-bar-container {
        height: 20px;
        width: 85%;
      }
      .loading-percentage {
        font-size: 18px;
      }
      .continue-text {
        font-size: 18px;
      }
      .title {
        font-size: 1.6rem;
      }
      .subtitle {
        font-size: 1rem;
      }
      #airplane {
        font-size: 60px;
      }
      .card {
        width: 85vw;
        padding: 20px;
        font-size: clamp(18px, 5vw, 22px);
      }
    }

    @keyframes pulseFade {
      0%, 100% { opacity: 0.5; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.05); }
    }

    @keyframes vibrate {
      0% { transform: translateX(0); }
      20% { transform: translateX(-1px); }
      40% { transform: translateX(1px); }
      60% { transform: translateX(-1px); }
      80% { transform: translateX(2px); }
      100% { transform: translateX(0); }
    }

    .pulsating-vibrating {
      animation: pulseFade 1.5s infinite ease-in-out, vibrate 1s infinite linear;
    }
  </style>
</head>
<body>
  <div id="loadingScreen">
    <div class="ml11">
      <span class="letters">Preparing your surprise1<span id="dots">...</span></span>
    </div>
    <div class="loading-bar-container">
      <div class="loading-bar" id="loadingBar"></div>
    </div>
    <div class="loading-percentage" id="loadingPercentage">0%</div>
    <div class="continue-text" id="continueText">Press ENTER or Tap to continue</div>
  </div>

  <div class="title">üéÇ Happy Birthday name üéÇ</div>
  <div id="globeViz"></div>
  <div id="popup" class="popup"></div>
  <div class="subtitle">From country1 to country2, to country3... and beyond ‚ù§Ô∏è</div>

  <div id="airplane">‚úàÔ∏è</div>

  <div id="infoCard" class="card"></div>
  <div class="nav-buttons">
    <button id="prevBtn" style="display:none;">‚¨Ö Previous</button>
    <button id="nextBtn" style="display:none;">Next ‚û°</button>
    <button id="endBtn" style="display:none;">End üéâ</button>
    <button id="startBtn" class="pulsing">Start ‚úàÔ∏è</button>
  </div>

  <script src="https://unpkg.com/globe.gl"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    // Animated dots
    setInterval(() => {
      const dots = document.getElementById('dots');
      dots.textContent = dots.textContent.length >= 3 ? '' : dots.textContent + '.';
    }, 500);

    // Simulate loading
    let load = 0;
    const bar = document.getElementById('loadingBar');
    const perc = document.getElementById('loadingPercentage');
    const contText = document.getElementById('continueText');
    const interval = setInterval(() => {
      if (load < 100) {
        load++;
        bar.style.width = load + '%';
        perc.textContent = load + '%';
      } else {
        clearInterval(interval);
        contText.style.opacity = 1;
        contText.classList.add('pulsating-vibrating');
      }
    }, 30);

    document.addEventListener('keydown', e => {
      if (e.key === 'Enter' && load >= 100) document.getElementById('loadingScreen').style.display = 'none';
    });
    document.addEventListener('click', () => {
      if (load >= 100) document.getElementById('loadingScreen').style.display = 'none';
    });

    setInterval(() => {
      confetti({ particleCount: 80, spread: 120, origin: { y: Math.random(), x: Math.random() }, zIndex: 0 });
    }, 1500);

    const elem = document.getElementById('globeViz');
    const card = document.getElementById('infoCard');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const endBtn = document.getElementById('endBtn');
    const startBtn = document.getElementById('startBtn');
    const airplane = document.getElementById('airplane');

    const places = [
      { lat: 25.0, lng: 19.0, name: "Turkey", message: "We first crossed paths here ‚Äî two lives meeting in the middle of a busy world. I didn‚Äôt know it then, but that moment was the start of something extraordinary.", img: "image1.jpg" },
      { lat: 26.5, lng: 42.2, name: "Azerbaijan", message: "You returned home, and I went my way‚Ä¶ but the distance never truly kept us apart. Every day we spoke, every day we laughed, and with every word our connection grew stronger.", img: "image2.jpg" },
      { lat: 22.5, lng: 14.5, name: "Greece", message: "Then you came to visit, and we turned days into memories. From sunlit streets to quiet moments by the sea, Greece became our playground of joy.", img: "image3.jpg" },
      { lat: 49.5, lng: 5.0, name: "Sweden", message: "Now, our eyes are set on a new horizon ‚Äî a place to start fresh, to dream bigger, and to build a life together one step at a time.", img: "image4.jpg" },
      { lat: 51.0, lng: -29.5, name: "Iceland", message: "And one day soon, we‚Äôll stand here, surrounded by the colors of the northern sky, living out a dream we‚Äôve carried in our hearts all along", img: "image5.jpg" }
    ];

    let currentIndex = -1;

    const world = Globe()(elem)
      .globeImageUrl('earth-cartoon.png')
      .bumpImageUrl(null)
      .backgroundColor('rgba(0,0,0,0)')
      .pointOfView({ lat: 20, lng: 0, altitude: 2 }, 0)
      .labelsData(places)
      .labelLat(d => d.lat)
      .labelLng(d => d.lng)
      .labelText(d => d.name)
      .labelSize(1)
      .labelDotRadius(0.65)
      .labelAltitude(0.01)
      .labelColor(() => 'white');

    function updateCard(index) {
      const place = places[index];
      card.innerHTML = `
        <img src="${place.img}" alt="${place.name}">
        <p>${place.message}</p>
      `;
      // choose corner for this place
      placeCardAtCorner(pickCardCornerFor(place.lat, place.lng));
    
      card.style.display = 'block';
      prevBtn.style.display = index > 0 ? 'inline-block' : 'none';
      nextBtn.style.display = index < places.length - 1 ? 'inline-block' : 'none';
      endBtn.style.display = index === places.length - 1 ? 'inline-block' : 'none';
    
      // center POV on the place
      world.pointOfView({ lat: place.lat, lng: place.lng, altitude: 0.8 }, 2000);
    }

    function flyPlaneTo(lat, lng, callback) {
      const targetX = window.innerWidth / 2 + (lng / 180) * (window.innerWidth / 2);
      const targetY = window.innerHeight / 2 - (lat / 90) * (window.innerHeight / 2);
      const dx = targetX - airplane.offsetLeft;
      const dy = targetY - airplane.offsetTop;
      const angle = Math.atan2(dy, dx) * 180 / Math.PI;
      const steps = 150;
      let step = 0;
      const startX = airplane.offsetLeft;
      const startY = airplane.offsetTop;

      function animate() {
        step++;
        const t = step / steps;
        const curveY = startY + dy * t - 50 * Math.sin(Math.PI * t);
        airplane.style.left = startX + dx * t + 'px';
        airplane.style.top = curveY + 'px';
        airplane.style.transform = `rotate(${angle}deg)`;

        if (step < steps) {
          requestAnimationFrame(animate);
        } else {
          if (callback) callback();
        }
      }
      animate();
    }

    function pickCardCornerFor(lat, lng) {
      // Rough heuristic using lat/lng relative to screen halves:
      // When you center POV on the place, the place will be near screen center.
      // We still bias corners using signs to vary placement and avoid overlap with title/subtitle.
      const preferTop = lat < 0;     // southern hem? prefer top to keep subtitle visible
      const preferLeft = lng > 0;    // eastern hem? prefer left
    
      if (preferTop && preferLeft) return 'card--tr';
      if (preferTop && !preferLeft) return 'card--tl';
      if (!preferTop && preferLeft) return 'card--br';
      return 'card--bl';
    }
    
    function placeCardAtCorner(cornerClass) {
      card.classList.remove('card--tl','card--tr','card--bl','card--br');
      card.classList.add(cornerClass);
    }

    startBtn.addEventListener('click', () => {
      startBtn.classList.remove('pulsing');
      startBtn.disabled = true;
      currentIndex = 0;
      flyPlaneTo(places[0].lat, places[0].lng, () => {
        updateCard(0);
        nextBtn.style.display = 'inline-block';
        startBtn.style.display = 'none';
      });
    });

    nextBtn.addEventListener('click', () => {
      if (currentIndex < places.length - 1) {
        nextBtn.disabled = true;
        currentIndex++;
        flyPlaneTo(places[currentIndex].lat, places[currentIndex].lng, () => {
          updateCard(currentIndex);
          nextBtn.disabled = false;
        });
      }
    });

    prevBtn.addEventListener('click', () => {
      if (currentIndex > 0) {
        prevBtn.disabled = true;
        currentIndex--;
        flyPlaneTo(places[currentIndex].lat, places[currentIndex].lng, () => {
          updateCard(currentIndex);
          prevBtn.disabled = false;
        });
      }
    });

    endBtn.addEventListener('click', () => {
      card.innerHTML = "<h2>üéâ Happy Birthday! üéâ</h2><p>And through it all, one truth remains ‚Äî you are my favorite story, my greatest adventure, and my happiest place. Happy 25th birthday, omorfia mou. Here‚Äôs to all the journeys still ahead. ‚ù§Ô∏è</p>";
      prevBtn.style.display = 'none';
      nextBtn.style.display = 'none';
      endBtn.style.display = 'none';
    });
  </script>
</body>
</html>
